<!doctype html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="atom.css">
</head>
<body>

  <style>
  #about a {
    color: blue;
    text-decoration: underline;
  }
  </style>
  <div id="about" style="margin: 5px">
  This is a demo of the editor for the <a href="http://atom.io">Atom</a> desktop IDE
  running in a browser. You can see the work I have been doing to make this possible in
  <a href="https://github.com/bolinfest/atom/commits/scratch-standalone">my fork on GitHub</a>.
  </div>

  <div id="status" style="display: none; color: #A00; margin: 5px;"></div>

  <div id="atom"></div>

  <script>
  // Best approximation of a Node built-in.
  window.setImmediate = function(callback) {
    return setTimeout(callback, 0);
  };

  function updateStatus(message) {
    var status = document.getElementById('status');
    status.innerHTML = message;
    status.style.display = 'block';
  }
  function onAtomLoadError() {
    updateStatus('Could not load atom.js. Check your console.');
  }
  </script>
  <script src="keymap_base.js"></script>
  <script src="keymap_darwin.js"></script>
  <script src="atom.js" onerror="onAtomLoadError()"></script>

  <!-- I think this is needed for SpacePen views. -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.js"></script>

  <script>
  (function() {
  try {
    new Set();
  } catch (e) {
    updateStatus(
        'ES6 features not available. ' +
        'Make sure to enable ES6 features via <b>chrome://flags/#enable-javascript-harmony</b>. ' +
        'Changing chrome://flags requires a Chrome restart.');
    return;
  }

  if (typeof Editor !== 'undefined') {
    // updateStatus('Success: global Atom Editor available!');
    doStuff();
  } else {
    updateStatus('atom.js loaded, but Editor failed to load.');
  }

  function doStuff() {
    var buffer = new TextBuffer({
      filePath: '/fake/filepath.txt',
      text: 'Type in here to try things out!\n\nThe content type of this buffer is \'plain\', so there is no syntax highlighting.',
    });
    var editor = new Editor({
      softTabs: false,
      initialLine: 1,
      initialColumn: 1,
      tabLength: 2,
      softWrap: false,
      displayBuffer: null,
      buffer: buffer,
      registerEditor: false,
      suppressCursorCreation: false,
    });

    // Look at EditorView.initialize() for an explanation of mini vs. non-mini.
    var editorView = new EditorView(editor);
    // var editorView = new EditorView({mini: true});
    editorView.setHeightInLines(4);

    var jQueryElement = $('#atom');
    // Invoking appendTo() has the side-effect of running EditorView's
    // afterAttach hook.
    editorView.appendTo(jQueryElement);
    editorView.requestDisplayUpdate();

    // This sets the default configuration, which has the side-effect of
    // enabling line numbers.
    atom.config.setDefaults('editor', EditorView.configDefaults);

    atom.keymaps.add('base', GLOBAL_KEYMAP_BASE);
    atom.keymaps.add('darwin', GLOBAL_KEYMAP_DARWIN);
  }

  })();
  </script>

</body>
</html>
